define(["RTVideo", "jquery"],
    function(RTVideo, $){

        function createRTVideoPlayer(data, el) {

            if($(el).data("ivaVideoId") && !data.isCountryUs) {
                $(el).append("<p>This content cannot be accessed from your location.</p>")
            } else {
                var imgUrl = $(el).data("imgUrl")
                new RTVideo({
                    el: el,
                    urlHLS: data.urlHLS,
                    urlMP4: data.urlMP4,
                    width: '100%',
                    thumbnailImg: (imgUrl || data.thumbnailImg),
                    preroll: {
                        dfpTarget: 'video/trailers',
                        custParams: {},
                        pageUrl: location.href
                    }
                });
            }
        }

        function requestIVAData(el) {
                var baseUrl = 'https://d1kvcmt7nceump.cloudfront.net/api/private/v1.0/wordpress/ivadata?'
                var rtVideoId = $(el).data("rtVideoId");
                var ivaVideoId = $(el).data("ivaVideoId");

                var url;

                if(rtVideoId) {
                    url = baseUrl + 'rtVideoId=' + rtVideoId
                } else if(ivaVideoId) {
                    url = baseUrl  + 'ivaVideoId=' + ivaVideoId
                }

            return $.ajax({
                 type: "GET",
                 url: url,
                 dataType: 'json',

                success: function(data){
                    createRTVideoPlayer(data, el);
                },

                error: function(){
                  alert("There was an issue with the request ");
                }
            });
        };

        function createJwPlayer(el) {
            var videoId = $(el).data("videoId"),
                noAds = $(el).data("noAds"),
                playerId = $(el).data("playerId");
            var playlistUrl =  'https://content.jwplatform.com/feeds/' + videoId + '.rss';
            var playerUrl = 'https://content.jwplatform.com/libraries/' + playerId;
            $.getScript(playerUrl, function() {
                new RTVideo({
                    el: el,
                    urlHLS: '',
                    urlMP4: '',
                    playlist: playlistUrl,
                    width: '100%',
                    listbar: (playerId === 'iNXVdlUI.js' || playerId === 'MqUJRq5i.js') ? {position:"bottom", size:200} : {},
                    preroll: {
                        dfpTarget: 'video/trailers',
                            custParams: {videoId: videoId},
                            pageUrl: location.href
                        },
                    noAds: noAds ? true : false
                });
            });
        };

        $('[id^="videoPlayer_"]').each(function(index, el){
            requestIVAData(el);
        }.bind(this));

        $('[id^="jwPlayer"]').each(function(index, el){
            createJwPlayer(el);
        }.bind(this));
    }
);
